using System;
using System.Diagnostics;
using System.IO;
using System.Net;
using System.Text.RegularExpressions;
using System.Threading;
using System.Threading.Tasks;
using System.Web.Script.Serialization;
using System.Windows.Forms;

public class RobloxClient
{
    public static Mutex robloxMutex;

    public static void InitMutex()
    {
        robloxMutex = new Mutex(true, "ROBLOX_singletonMutex");
    }

    public static void UninitMutex()
    {
        if (robloxMutex != null)
        {
            robloxMutex.Close();
            robloxMutex.Dispose();
        }
    }

    public static void ExitApp() // this is called everytime we want to exit the application
    {
        UninitMutex();
        Process.GetCurrentProcess().Kill();
    }

    public static WebClient wc = new WebClient();

    public static void UpdateRoblox()
    {
        MDIDirectory.CheckCreate("Tmp");
        wc.DownloadFile("https://setup.rbxcdn.com/" + RobloxProcess.version + "-Roblox.exe",
            MDI.mdiBase + "\\Tmp\\RobloxPlayerLauncher.exe");
        Process.Start(MDI.mdiBase + "\\Tmp\\RobloxPlayerLauncher.exe");
    }

    // https://github.com/L8X/Roblox-Client-Optimizer/tree/main auto optimize
    public static void SetFPS(string robloxPath, int fps)
    {
        if (Directory.Exists(robloxPath + "\\ClientSettings"))
        {
            // rewrite 2 file with new settings if it exists else creates it
            File.WriteAllText(robloxPath + "\\ClientSettings\\ClientAppSettings.json", $"{{\"BuildVariantInBacktrace\":false,\"DFFlagAddAdditionalTagsEventIngest2\":false,\"DFFlagAddGlobalAnalyticsPlaySessionId\":false,\"DFFlagAddGlobalWindToPlaceStats\":false,\"DFFlagAdditionalUWPCrashReportData\":false,\"DFFlagAddLightingToPlaceStats\":false,\"DFFlagAddPlaySessionIdTelemetry\":false,\"DFFlagAddPublicGettersForGfxQualityAndFpsForTelemCounters\":false,\"DFFlagAddPublicGettersForGfxQualityAndFpsForTelemCounters2\":false,\"DFFlagAddStreamingEnabledTagEventIngest\":false,\"DFFlagAddUserIdToSessionTracking\":false,\"DFFlagAlwaysPutSoundsOnDiskWhenLowOnMemory\":true,\"DFFlagAMPTelemetryPoints\":false,\"DFFlagAMPTelemetryUser\":false,\"DFFlagAttachmentCrashReport\":false,\"DFFlagAudioDeviceTelemetry\":false,\"DFFlagAUMPAnalytics\":false,\"DFFlagBaseNetworkMetrics\":false,\"DFFlagBrowserTrackerIdTelemetryEnabled\":false,\"DFFlagChatFloodCheckEnableEventCounters\":false,\"DFFlagChatFloodCheckEnableEventIngest\":false,\"DFFlagClientBaseNetworkMetrics\":false,\"DFFlagCountOldChatAPIUsageV2\":false,\"DFFlagCrashpadReportGfx\":false,\"DFFlagCrashUploadFullDumps\":false,\"DFFlagDebugAnalyticsSendUserId\":false,\"DFFlagDynamicFastVariableReloaderTest1\":false,\"DFFlagEarlyExitIfHang\":false,\"DFFlagEnableExtraUnreachableTelemetry\":false,\"DFFlagEnableGCapsHardwareTelemetry\":false,\"DFFlagEnableHardwareTelemetry\":false,\"DFFlagEnableHttpCacheForceRevalidate2\":false,\"DFFlagEnableHumanoidStateChangeTelemtry\":false,\"DFFlagEnableHumanoidStateChangeTelemtryOldStateDuration\":false,\"DFFlagEnableLightstepReporting2\":false,\"DFFlagEnableLogServiceCounter\":false,\"DFFlagEnableLuobuCDNDomain\":false,\"DFFlagEnableLuobuServiceDomain\":false,\"DFFlagEnableMemProfilingOutsideClient\":false,\"DFFlagEnableMemProfilingStorePlaceId\":false,\"DFFlagEnablePercentileTelemetry\":false,\"DFFlagEnablePerfAudioCollection\":false,\"DFFlagEnablePerfDataCoreCategoryTimersCollection2\":false,\"DFFlagEnablePerfDataCoreTimersCollection2\":false,\"DFFlagEnablePerfDataCountersCollection\":false,\"DFFlagEnablePerfDataGatherTelemetry2\":false,\"DFFlagEnablePerfDataMemoryCategoriesCollection2\":false,\"DFFlagEnablePerfDataMemoryCollection\":false,\"DFFlagEnablePerfDataMemoryPerformanceCleanup3\":false,\"DFFlagEnablePerfDataMemoryPressureCollection\":false,\"DFFlagEnablePerfDataReportThermals\":false,\"DFFlagEnablePerfDataSubsystemTimersCollection2\":false,\"DFFlagEnablePerfDataSummaryMode\":false,\"DFFlagEnablePerfRenderStatsCollection2\":false,\"DFFlagEnablePerfStatsCollection3\":false,\"DFFlagEnableRobloxCNDomains\":false,\"DFFlagEnableRolloutFlagCrashDataMacClient\":false,\"DFFlagEnableRolloutFlagCrashDataUWP\":false,\"DFFlagEphemeralCounterInfluxReportingEnabled\":false,\"DFFlagESGamePerfMonitorEnabled\":false,\"DFFlagExperimentalRuntimeTextureCreation\":true,\"DFFlagHttpCacheCleanBasedOnMemory\":true,\"DFFlagHttpClientRequestMetrics2\":false,\"DFFlagHttpLogRedirects\":false,\"DFFlagHttpPointsErrorMetrics\":false,\"DFFlagHttpPointsResponseMetrics\":false,\"DFFlagHttpReportAnalyticsTelem\":false,\"DFFlagHttpServiceErrorLogEnabled\":false,\"DFFlagHttpTraceErrorCurrentUrl\":false,\"DFFlagHttpTraceErrorProxy\":false,\"DFFlagIncludeFreeOsMemAndOtherTelemetryForHarmony\":false,\"DFFlagInferredCrashMemReportingV2\":false,\"DFFlagInferredCrashSystemSuccessReportMove\":false,\"DFFlagLegacyRedundantPlayerCheckAnalytics\":false,\"DFFlagMemoryPressureGCStats\":false,\"DFFlagNewInferredCrashSystem\":false,\"DFFlagNewInferredCrashSystemV2\":false,\"DFFlagNewInferredCrashTelemetrySystem\":false,\"DFFlagOOMTimestamp2\":false,\"DFFlagOsVersionWin32\":false,\"DFFlagPhysicsAnalytics\":false,\"DFFlagPhysicsReceiveReportPerfData2\":false,\"DFFlagPredictedOOM\":false,\"DFFlagPredictedOOMAbs\":false,\"DFFlagProximityPromptAnalytics\":false,\"DFFlagQueueDataPingFromSendData\":true,\"DFFlagReportGlobalAnalyticsUniverseAndPlaceIds\":false,\"DFFlagSafetyServiceScreenshot\":false,\"DFFlagStoreUniqueIdInferredCrashSystem\":false,\"DFFlagThrottleDeveloperConsoleEvents\":true,\"DFFlagUsePredictedOOMAbsLimitForMemoryCurve\":false,\"DFFlagVoiceChatEnableEventCounters3\":false,\"DFFlagVoiceChatHttpResultBodyEmptyTelemetry\":false,\"DFFlagVoiceChatUnderrunErrorsTelemetry\":false,\"DFIntBrowserTrackerApiDeviceInitializeRolloutPercentage\":0,\"DFIntClusterCompressionLevel\":2,\"DFIntCrashReportingHundredthsPercentage\":0,\"DFIntCrashUploadErrorInfluxHundredthsPercentage\":0,\"DFIntCrashUploadToBacktracePercentage\":0,\"DFIntEphemeralCounterInfluxReportingPriorityHundredthsPercent\":0,\"DFIntEphemeralStatsInfluxReportingPriorityHundredthsPercent\":0,\"DFIntESGamePerfMonitorHundredthsPercentage\":0,\"DFIntExternalHttpRequestSizeLimitKB\":16384,\"DFIntGoogleAnalyticsLoadPlayerHundredth\":0,\"DFIntHardwareTelemetryHundredthsPercent\":0,\"DFIntHttpAnalyticsMaxHistory\":0,\"DFIntHttpBatchApi_maxReqs\":4,\"DFIntHttpCacheRefreshHundredthsPercent\":75,\"DFIntHttpCacheRetryCount\":4,\"DFIntHttpConnMaxAge\":3600,\"DFIntHttpCurlConnectionCacheSize\":134217728,\"DFIntHttpCurlMaxConnectionsPerHost\":32,\"DFIntHttpGAFailureReportPercent\":0,\"DFIntHttpInfluxHundredthsPercentage\":0,\"DFIntHttpInfluxReportsPerMillion\":0,\"DFIntHttpMaxRedirects\":6,\"DFIntHttpMaxRetries\":4,\"DFIntInferredOOMUsedMemHundredthsPercent\":0,\"DFIntJoinDataCompressionLevel\":2,\"DFIntLightstepHTTPTransportHundredthsPercent2\":0,\"DFIntLmsClientMaxTargets\":0,\"DFIntLogFileTelemetryInfluxDbHundredthsPercentage\":0,\"DFIntLoginTelemetryHundredthsPercent\":0,\"DFIntNetworkSchemaCompressionRatio\":18,\"DFIntPercentileTelemetryHundredPercent\":0,\"DFIntPredictedOOMPercent\":0,\"DFIntRenderingThrottleDelayInMS\":20,\"DFIntReportDeviceInfoRate\":0,\"DFIntReportFmodErrorsRate\":0,\"DFIntSecondsBetweenDynamicVariableReloading\":31557600,\"DFIntSendAvatarLoadTimeStats_HundredthsPercentage\":0,\"DFIntSendHttpRbxApiStatsToDiag_HundredthsPercentage\":0,\"DFIntSendJoinHttpBytesToDiag_HundredthsPercentage\":0,\"DFIntSendJoinTimeDeltasToDiag_HundredthsPercentage\":0,\"DFIntSendJoinTimeDeltasToDiagLuobu_HundredthsPercentage\":0,\"DFIntSendJoinTimeStatsHundPrecLuobuOverride\":0,\"DFIntSendJoinTimeStatsToDiag_HundredthsPercentage\":0,\"DFIntSendJoinTimesToDiag_HundredthsPercentage\":0,\"DFIntTaskSchedulerTargetFps\":{fps},\"DFIntUserIdPlayerNameCacheSize\":33554432,\"DFIntUserIdPlayerNameLifetimeSeconds\":86400,\"DFIntWriteFullDmpPercent\":0,\"DFLogBatchAssetApiLog\":6,\"DFLogHttpTrace\":0,\"DFLogHttpTraceError\":0,\"DFLogHttpTraceLight\":0,\"DFStringAltHttpPointsReporterUrl\":\"https://opt-out.roblox.com\",\"DFStringAltTelegrafHTTPTransportUrl\":\"http://opt-out.roblox.com\",\"DFStringAnalyticsEventStreamUrlEndpoint\":\"opt-out\",\"DFStringAnalyticsNS1ApplicationId\":\"opt-out\",\"DFStringAnalyticsNS1BeaconConfig\":\"https://opt-out.roblox.com\",\"DFStringCrashUploadToBacktraceBaseUrl\":\"https://opt-out.roblox.com\",\"DFStringCrashUploadToBacktraceMacPlayerToken\":\"opt-out\",\"DFStringCrashUploadToBacktraceTestingToken\":\"opt-out\",\"DFStringCrashUploadToBacktraceWindowsPlayerToken\":\"opt-out\",\"DFStringHttpPointsReporterUrl\":\"https://opt-out.roblox.com\",\"DFStringLightstepHTTPTransportUrlHost\":\"https://opt-out.roblox.com\",\"DFStringLightstepHTTPTransportUrlPath\":\"/opt-out\",\"DFStringLightstepToken\":\"opt-out\",\"DFStringLmsRecipeEndpoint\":\"/opt-out\",\"DFStringLmsReportEndpoint\":\"/opt-out\",\"DFStringRobloxAnalyticsSubDomain\":\"opt-out\",\"DFStringRobloxAnalyticsURL\":\"https://opt-out.roblox.com\",\"DFStringTelegrafHTTPTransportUrl\":\"https://opt-out.roblox.com\",\"FFlagAdServiceEnabled\":false,\"FFlagAnimationClipMemCacheEnabled\":true,\"FFlagBacktraceMainSourcePathEnabled\":false,\"FFlagBatchAssetApi\":true,\"FFlagCacheHardwareInfo\":true,\"FFlagCacheRequestedMaxSize\":true,\"FFlagCommitToGraphicsQualityFix\":true,\"FFlagContactImporterAddBacktraceAttribute\":false,\"FFlagDebugForceFSMCPULightCulling\":true,\"FFlagDontCreatePingJob\":true,\"FFlagEnableAdsAPI\":false,\"FFlagEnableBacktraceAttachmentsV3\":false,\"FFlagEnableBacktraceConnectionDidFailHandler\":false,\"FFlagEnableBacktraceMissingLogReport\":false,\"FFlagEnableBacktraceResponseHandler\":false,\"FFlagEnableBatteryStateLogger\":false,\"FFlagEnableFlagRolloutCrashReportingWindows\":false,\"FFlagEnableQuickGameLaunch\":true,\"FFlagEnableReportAnythingAnalytics\":false,\"FFlagEnableSoundTelemetry\":false,\"FFlagEnableZeroLatencyCacheForVersionedAssets\":true,\"FFlagExecDynInitTests\":false,\"FFlagFastGPULightCulling3\":true,\"FFlagFinishFetchingAssetsCorrectly\":true,\"FFlagFixGraphicsQuality\":true,\"FFlagFixTextureCompositorFramebufferManagement2\":true,\"FFlagGraphicsD3D11AllowThreadSafeTextureUpload\":true,\"FFlagGraphicsEnableD3D10Compute\":true,\"FFlagGraphicsTextureCopy\":true,\"FFlagHandleAltEnterFullscreenManually\":false,\"FFlagHumanoidParallelFasterSetCollision\":true,\"FFlagHumanoidParallelFasterWakeUp\":true,\"FFlagHumanoidParallelFixTickleFloor2\":true,\"FFlagHumanoidParallelOnStep2\":true,\"FFlagHumanoidParallelSafeCofmUpdate\":true,\"FFlagHumanoidParallelSafeUnseat\":true,\"FFlagHumanoidParallelUseManager4\":true,\"FFlagImmersiveAdsWhitelistDisabled\":false,\"FFlagJoinTimeCounters\":false,\"FFlagLocServicePerformanceAnalyticsEnabled\":false,\"FFlagLuobuLuaAuthEnabled\":false,\"FFlagLuobuModerationStatusAvailable\":false,\"FFlagNFDN2644ExplicitlyConstructCrashReporterInStartup\":false,\"FFlagPreloadAllFonts\":true,\"FFlagPreloadMinimalFonts\":true,\"FFlagPreloadTextureItemsOption4\":true,\"FFlagRenderGpuTextureCompressor\":true,\"FFlagReportFpsAndGfxQualityPercentiles\":false,\"FFlagReportJoinTelemetry\":false,\"FFlagSessionTelemetryApp\":false,\"FFlagTrackPlaceIdForCrashEnabled\":false,\"FFlagUpdateUICachesWithQuadTree3\":true,\"FFlagUseMediumpSamplers\":true,\"FFlagUserAgentInBacktraceReports\":false,\"FFlagVoiceChatEnableBlockTelemetry\":false,\"FFlagVoiceChatStatsMultistreamSubscriptionsV2\":false,\"FFlagWin32BacktraceWindowsLaunchType\":false,\"FFlagWin32CrashUploadRobloxTelemetry\":false,\"FFlagWindowsLaunchTypeAnalytics\":false,\"FIntAbuseReportScreenshotMaxSize\":0,\"FIntBacktraceUseSyncPercentage\":0,\"FIntClientCompressionFormatRequestPC\":3,\"FIntDefaultMeshCacheSizeMB\":256,\"FIntEmotesAnimationsPerPlayerCacheSize\":16777216,\"FIntGamePerfMonitorPercentage\":0,\"FIntHttpCurlMaxCachedHandlesPerHost\":16,\"FIntLuaAppBacktraceErrorReportPercentage\":0,\"FIntMaxCachedPatches\":2,\"FIntMeshContentProviderForceCacheSize\":268435456,\"FIntRenderShaderLoadAnalyticsHundredthPercent\":0,\"FIntReportDeviceInfoRollout\":0,\"FIntRolloutEnrollmentExpirationMinutes\":525949,\"FIntSSAOMipLevels\":0,\"FIntTaskSchedulerAutoThreadLimit\":16,\"FIntTerrainOTAMaxTextureSize\":1024,\"FIntUITextureMaxRenderTextureSize\":1024,\"FStringCoreScriptBacktraceErrorUploadToken\":\"opt-out\",\"FStringErrorUploadToBacktraceBaseUrl\":\"https://opt-out.roblox.com\",\"FStringFeature_LuobuLuaAuthEnabled\":\"0;0\",\"FStringFlagUpdateVersion\":\"139 Beta - Version 14\",\"FStringGamesUrlPath\":\"/games/\",\"FStringImmersiveAdsUniverseWhitelist\":\"0\",\"GoogleAnalyticsAccountPropertyID\":\"opt-out\",\"GoogleAnalyticsAccountPropertyIDPlayer\":\"opt-out\",\"HttpDetailedLogging\":false}}");

            return;
        }

        // config doesnt exist yet so we make our own
        Directory.CreateDirectory(robloxPath + "\\ClientSettings");
        File.WriteAllText(robloxPath + "\\ClientSettings\\ClientAppSettings.json", $"{{\"BuildVariantInBacktrace\":false,\"DFFlagAddAdditionalTagsEventIngest2\":false,\"DFFlagAddGlobalAnalyticsPlaySessionId\":false,\"DFFlagAddGlobalWindToPlaceStats\":false,\"DFFlagAdditionalUWPCrashReportData\":false,\"DFFlagAddLightingToPlaceStats\":false,\"DFFlagAddPlaySessionIdTelemetry\":false,\"DFFlagAddPublicGettersForGfxQualityAndFpsForTelemCounters\":false,\"DFFlagAddPublicGettersForGfxQualityAndFpsForTelemCounters2\":false,\"DFFlagAddStreamingEnabledTagEventIngest\":false,\"DFFlagAddUserIdToSessionTracking\":false,\"DFFlagAlwaysPutSoundsOnDiskWhenLowOnMemory\":true,\"DFFlagAMPTelemetryPoints\":false,\"DFFlagAMPTelemetryUser\":false,\"DFFlagAttachmentCrashReport\":false,\"DFFlagAudioDeviceTelemetry\":false,\"DFFlagAUMPAnalytics\":false,\"DFFlagBaseNetworkMetrics\":false,\"DFFlagBrowserTrackerIdTelemetryEnabled\":false,\"DFFlagChatFloodCheckEnableEventCounters\":false,\"DFFlagChatFloodCheckEnableEventIngest\":false,\"DFFlagClientBaseNetworkMetrics\":false,\"DFFlagCountOldChatAPIUsageV2\":false,\"DFFlagCrashpadReportGfx\":false,\"DFFlagCrashUploadFullDumps\":false,\"DFFlagDebugAnalyticsSendUserId\":false,\"DFFlagDynamicFastVariableReloaderTest1\":false,\"DFFlagEarlyExitIfHang\":false,\"DFFlagEnableExtraUnreachableTelemetry\":false,\"DFFlagEnableGCapsHardwareTelemetry\":false,\"DFFlagEnableHardwareTelemetry\":false,\"DFFlagEnableHttpCacheForceRevalidate2\":false,\"DFFlagEnableHumanoidStateChangeTelemtry\":false,\"DFFlagEnableHumanoidStateChangeTelemtryOldStateDuration\":false,\"DFFlagEnableLightstepReporting2\":false,\"DFFlagEnableLogServiceCounter\":false,\"DFFlagEnableLuobuCDNDomain\":false,\"DFFlagEnableLuobuServiceDomain\":false,\"DFFlagEnableMemProfilingOutsideClient\":false,\"DFFlagEnableMemProfilingStorePlaceId\":false,\"DFFlagEnablePercentileTelemetry\":false,\"DFFlagEnablePerfAudioCollection\":false,\"DFFlagEnablePerfDataCoreCategoryTimersCollection2\":false,\"DFFlagEnablePerfDataCoreTimersCollection2\":false,\"DFFlagEnablePerfDataCountersCollection\":false,\"DFFlagEnablePerfDataGatherTelemetry2\":false,\"DFFlagEnablePerfDataMemoryCategoriesCollection2\":false,\"DFFlagEnablePerfDataMemoryCollection\":false,\"DFFlagEnablePerfDataMemoryPerformanceCleanup3\":false,\"DFFlagEnablePerfDataMemoryPressureCollection\":false,\"DFFlagEnablePerfDataReportThermals\":false,\"DFFlagEnablePerfDataSubsystemTimersCollection2\":false,\"DFFlagEnablePerfDataSummaryMode\":false,\"DFFlagEnablePerfRenderStatsCollection2\":false,\"DFFlagEnablePerfStatsCollection3\":false,\"DFFlagEnableRobloxCNDomains\":false,\"DFFlagEnableRolloutFlagCrashDataMacClient\":false,\"DFFlagEnableRolloutFlagCrashDataUWP\":false,\"DFFlagEphemeralCounterInfluxReportingEnabled\":false,\"DFFlagESGamePerfMonitorEnabled\":false,\"DFFlagExperimentalRuntimeTextureCreation\":true,\"DFFlagHttpCacheCleanBasedOnMemory\":true,\"DFFlagHttpClientRequestMetrics2\":false,\"DFFlagHttpLogRedirects\":false,\"DFFlagHttpPointsErrorMetrics\":false,\"DFFlagHttpPointsResponseMetrics\":false,\"DFFlagHttpReportAnalyticsTelem\":false,\"DFFlagHttpServiceErrorLogEnabled\":false,\"DFFlagHttpTraceErrorCurrentUrl\":false,\"DFFlagHttpTraceErrorProxy\":false,\"DFFlagIncludeFreeOsMemAndOtherTelemetryForHarmony\":false,\"DFFlagInferredCrashMemReportingV2\":false,\"DFFlagInferredCrashSystemSuccessReportMove\":false,\"DFFlagLegacyRedundantPlayerCheckAnalytics\":false,\"DFFlagMemoryPressureGCStats\":false,\"DFFlagNewInferredCrashSystem\":false,\"DFFlagNewInferredCrashSystemV2\":false,\"DFFlagNewInferredCrashTelemetrySystem\":false,\"DFFlagOOMTimestamp2\":false,\"DFFlagOsVersionWin32\":false,\"DFFlagPhysicsAnalytics\":false,\"DFFlagPhysicsReceiveReportPerfData2\":false,\"DFFlagPredictedOOM\":false,\"DFFlagPredictedOOMAbs\":false,\"DFFlagProximityPromptAnalytics\":false,\"DFFlagQueueDataPingFromSendData\":true,\"DFFlagReportGlobalAnalyticsUniverseAndPlaceIds\":false,\"DFFlagSafetyServiceScreenshot\":false,\"DFFlagStoreUniqueIdInferredCrashSystem\":false,\"DFFlagThrottleDeveloperConsoleEvents\":true,\"DFFlagUsePredictedOOMAbsLimitForMemoryCurve\":false,\"DFFlagVoiceChatEnableEventCounters3\":false,\"DFFlagVoiceChatHttpResultBodyEmptyTelemetry\":false,\"DFFlagVoiceChatUnderrunErrorsTelemetry\":false,\"DFIntBrowserTrackerApiDeviceInitializeRolloutPercentage\":0,\"DFIntClusterCompressionLevel\":2,\"DFIntCrashReportingHundredthsPercentage\":0,\"DFIntCrashUploadErrorInfluxHundredthsPercentage\":0,\"DFIntCrashUploadToBacktracePercentage\":0,\"DFIntEphemeralCounterInfluxReportingPriorityHundredthsPercent\":0,\"DFIntEphemeralStatsInfluxReportingPriorityHundredthsPercent\":0,\"DFIntESGamePerfMonitorHundredthsPercentage\":0,\"DFIntExternalHttpRequestSizeLimitKB\":16384,\"DFIntGoogleAnalyticsLoadPlayerHundredth\":0,\"DFIntHardwareTelemetryHundredthsPercent\":0,\"DFIntHttpAnalyticsMaxHistory\":0,\"DFIntHttpBatchApi_maxReqs\":4,\"DFIntHttpCacheRefreshHundredthsPercent\":75,\"DFIntHttpCacheRetryCount\":4,\"DFIntHttpConnMaxAge\":3600,\"DFIntHttpCurlConnectionCacheSize\":134217728,\"DFIntHttpCurlMaxConnectionsPerHost\":32,\"DFIntHttpGAFailureReportPercent\":0,\"DFIntHttpInfluxHundredthsPercentage\":0,\"DFIntHttpInfluxReportsPerMillion\":0,\"DFIntHttpMaxRedirects\":6,\"DFIntHttpMaxRetries\":4,\"DFIntInferredOOMUsedMemHundredthsPercent\":0,\"DFIntJoinDataCompressionLevel\":2,\"DFIntLightstepHTTPTransportHundredthsPercent2\":0,\"DFIntLmsClientMaxTargets\":0,\"DFIntLogFileTelemetryInfluxDbHundredthsPercentage\":0,\"DFIntLoginTelemetryHundredthsPercent\":0,\"DFIntNetworkSchemaCompressionRatio\":18,\"DFIntPercentileTelemetryHundredPercent\":0,\"DFIntPredictedOOMPercent\":0,\"DFIntRenderingThrottleDelayInMS\":20,\"DFIntReportDeviceInfoRate\":0,\"DFIntReportFmodErrorsRate\":0,\"DFIntSecondsBetweenDynamicVariableReloading\":31557600,\"DFIntSendAvatarLoadTimeStats_HundredthsPercentage\":0,\"DFIntSendHttpRbxApiStatsToDiag_HundredthsPercentage\":0,\"DFIntSendJoinHttpBytesToDiag_HundredthsPercentage\":0,\"DFIntSendJoinTimeDeltasToDiag_HundredthsPercentage\":0,\"DFIntSendJoinTimeDeltasToDiagLuobu_HundredthsPercentage\":0,\"DFIntSendJoinTimeStatsHundPrecLuobuOverride\":0,\"DFIntSendJoinTimeStatsToDiag_HundredthsPercentage\":0,\"DFIntSendJoinTimesToDiag_HundredthsPercentage\":0,\"DFIntTaskSchedulerTargetFps\":{fps},\"DFIntUserIdPlayerNameCacheSize\":33554432,\"DFIntUserIdPlayerNameLifetimeSeconds\":86400,\"DFIntWriteFullDmpPercent\":0,\"DFLogBatchAssetApiLog\":6,\"DFLogHttpTrace\":0,\"DFLogHttpTraceError\":0,\"DFLogHttpTraceLight\":0,\"DFStringAltHttpPointsReporterUrl\":\"https://opt-out.roblox.com\",\"DFStringAltTelegrafHTTPTransportUrl\":\"http://opt-out.roblox.com\",\"DFStringAnalyticsEventStreamUrlEndpoint\":\"opt-out\",\"DFStringAnalyticsNS1ApplicationId\":\"opt-out\",\"DFStringAnalyticsNS1BeaconConfig\":\"https://opt-out.roblox.com\",\"DFStringCrashUploadToBacktraceBaseUrl\":\"https://opt-out.roblox.com\",\"DFStringCrashUploadToBacktraceMacPlayerToken\":\"opt-out\",\"DFStringCrashUploadToBacktraceTestingToken\":\"opt-out\",\"DFStringCrashUploadToBacktraceWindowsPlayerToken\":\"opt-out\",\"DFStringHttpPointsReporterUrl\":\"https://opt-out.roblox.com\",\"DFStringLightstepHTTPTransportUrlHost\":\"https://opt-out.roblox.com\",\"DFStringLightstepHTTPTransportUrlPath\":\"/opt-out\",\"DFStringLightstepToken\":\"opt-out\",\"DFStringLmsRecipeEndpoint\":\"/opt-out\",\"DFStringLmsReportEndpoint\":\"/opt-out\",\"DFStringRobloxAnalyticsSubDomain\":\"opt-out\",\"DFStringRobloxAnalyticsURL\":\"https://opt-out.roblox.com\",\"DFStringTelegrafHTTPTransportUrl\":\"https://opt-out.roblox.com\",\"FFlagAdServiceEnabled\":false,\"FFlagAnimationClipMemCacheEnabled\":true,\"FFlagBacktraceMainSourcePathEnabled\":false,\"FFlagBatchAssetApi\":true,\"FFlagCacheHardwareInfo\":true,\"FFlagCacheRequestedMaxSize\":true,\"FFlagCommitToGraphicsQualityFix\":true,\"FFlagContactImporterAddBacktraceAttribute\":false,\"FFlagDebugForceFSMCPULightCulling\":true,\"FFlagDontCreatePingJob\":true,\"FFlagEnableAdsAPI\":false,\"FFlagEnableBacktraceAttachmentsV3\":false,\"FFlagEnableBacktraceConnectionDidFailHandler\":false,\"FFlagEnableBacktraceMissingLogReport\":false,\"FFlagEnableBacktraceResponseHandler\":false,\"FFlagEnableBatteryStateLogger\":false,\"FFlagEnableFlagRolloutCrashReportingWindows\":false,\"FFlagEnableQuickGameLaunch\":true,\"FFlagEnableReportAnythingAnalytics\":false,\"FFlagEnableSoundTelemetry\":false,\"FFlagEnableZeroLatencyCacheForVersionedAssets\":true,\"FFlagExecDynInitTests\":false,\"FFlagFastGPULightCulling3\":true,\"FFlagFinishFetchingAssetsCorrectly\":true,\"FFlagFixGraphicsQuality\":true,\"FFlagFixTextureCompositorFramebufferManagement2\":true,\"FFlagGraphicsD3D11AllowThreadSafeTextureUpload\":true,\"FFlagGraphicsEnableD3D10Compute\":true,\"FFlagGraphicsTextureCopy\":true,\"FFlagHandleAltEnterFullscreenManually\":false,\"FFlagHumanoidParallelFasterSetCollision\":true,\"FFlagHumanoidParallelFasterWakeUp\":true,\"FFlagHumanoidParallelFixTickleFloor2\":true,\"FFlagHumanoidParallelOnStep2\":true,\"FFlagHumanoidParallelSafeCofmUpdate\":true,\"FFlagHumanoidParallelSafeUnseat\":true,\"FFlagHumanoidParallelUseManager4\":true,\"FFlagImmersiveAdsWhitelistDisabled\":false,\"FFlagJoinTimeCounters\":false,\"FFlagLocServicePerformanceAnalyticsEnabled\":false,\"FFlagLuobuLuaAuthEnabled\":false,\"FFlagLuobuModerationStatusAvailable\":false,\"FFlagNFDN2644ExplicitlyConstructCrashReporterInStartup\":false,\"FFlagPreloadAllFonts\":true,\"FFlagPreloadMinimalFonts\":true,\"FFlagPreloadTextureItemsOption4\":true,\"FFlagRenderGpuTextureCompressor\":true,\"FFlagReportFpsAndGfxQualityPercentiles\":false,\"FFlagReportJoinTelemetry\":false,\"FFlagSessionTelemetryApp\":false,\"FFlagTrackPlaceIdForCrashEnabled\":false,\"FFlagUpdateUICachesWithQuadTree3\":true,\"FFlagUseMediumpSamplers\":true,\"FFlagUserAgentInBacktraceReports\":false,\"FFlagVoiceChatEnableBlockTelemetry\":false,\"FFlagVoiceChatStatsMultistreamSubscriptionsV2\":false,\"FFlagWin32BacktraceWindowsLaunchType\":false,\"FFlagWin32CrashUploadRobloxTelemetry\":false,\"FFlagWindowsLaunchTypeAnalytics\":false,\"FIntAbuseReportScreenshotMaxSize\":0,\"FIntBacktraceUseSyncPercentage\":0,\"FIntClientCompressionFormatRequestPC\":3,\"FIntDefaultMeshCacheSizeMB\":256,\"FIntEmotesAnimationsPerPlayerCacheSize\":16777216,\"FIntGamePerfMonitorPercentage\":0,\"FIntHttpCurlMaxCachedHandlesPerHost\":16,\"FIntLuaAppBacktraceErrorReportPercentage\":0,\"FIntMaxCachedPatches\":2,\"FIntMeshContentProviderForceCacheSize\":268435456,\"FIntRenderShaderLoadAnalyticsHundredthPercent\":0,\"FIntReportDeviceInfoRollout\":0,\"FIntRolloutEnrollmentExpirationMinutes\":525949,\"FIntSSAOMipLevels\":0,\"FIntTaskSchedulerAutoThreadLimit\":16,\"FIntTerrainOTAMaxTextureSize\":1024,\"FIntUITextureMaxRenderTextureSize\":1024,\"FStringCoreScriptBacktraceErrorUploadToken\":\"opt-out\",\"FStringErrorUploadToBacktraceBaseUrl\":\"https://opt-out.roblox.com\",\"FStringFeature_LuobuLuaAuthEnabled\":\"0;0\",\"FStringFlagUpdateVersion\":\"139 Beta - Version 14\",\"FStringGamesUrlPath\":\"/games/\",\"FStringImmersiveAdsUniverseWhitelist\":\"0\",\"GoogleAnalyticsAccountPropertyID\":\"opt-out\",\"GoogleAnalyticsAccountPropertyIDPlayer\":\"opt-out\",\"HttpDetailedLogging\":false}}");
    }

    // fixed GetMainUniverse function
    public static RobloxUniverse GetMainUniverse(string placeId)
    {
        JavaScriptSerializer jss = new JavaScriptSerializer();

        // scrap html for universe id
        string result = wc.DownloadString($"https://www.roblox.com/games/{placeId}");
        string universeId = Regex.Match(result, @"universe-id=""(.*?)"">").Groups[1].Value;

        // get universe root as json then deserialize into C# object
        string json = wc.DownloadString("https://games.roblox.com/v1/games?universeIds=" + universeId);

        return jss.Deserialize<RobloxUniverse>(json);
    }

    public static string GetInstallPath()
    {
        string output = "";

        string robloxFolder = Environment.GetFolderPath(Environment.SpecialFolder.LocalApplicationData) + "\\Roblox\\Versions";
        string robloxPFPath = "C:\\Program Files (x86)\\Roblox\\Versions";


        if (Directory.Exists(robloxFolder))
            output = robloxFolder;

        if (Directory.Exists(robloxPFPath))
            output = robloxPFPath;

        return output;
    }
}